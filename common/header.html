<script type="text/discourse-plugin" version="0.8">
function getVaperinaPanel() {
  let pref = localStorage.getItem("vaperinaPanel");
  let result = settings.default_enabled;
  if (pref !== null) {
    result = pref === "true";
  }
  return result;
}

// technically we only want to amend current user here
api.modifyClass("model:user", {
  mobileSwitchTitle: function() {
    return getVaperinaPanel();
  }.property()
});

api.modifyClass("controller:preferences/interface", {
  actions: {
    save() {
      this._super();
      if (getVaperinaPanel() != this.get("model.vaperinaPanel")) {
        Discourse.set("assetVersion", "forceRefresh");
      }
      localStorage.setItem(
        "vaperinaPanel",
        this.get("model.vaperinaPanel").toString()
      );
    }
  }
});
</script>

<script type='text/x-handlebars' data-template-name='/connectors/user-preferences-interface/add-selector'>
  {{preference-checkbox labelKey=(theme-prefix 'vaperinaPanel') checked=model.vaperinaPanel}}
</script>
